<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FRUNO ‚Äî MiniApp (prototype)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #FB702C; /* –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --primary-light: #FFEBD2; /* –°–≤–µ—Ç–ª—ã–π –±–µ–∂–µ–≤—ã–π */
      --secondary: #F1EAA2; /* –°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π */
      --accent: #20AC17; /* –ó–µ–ª–µ–Ω—ã–π */
      --accent-light: #45A03F; /* –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π */
      --text: #222;
      --muted: #666;
      --bg: #fbfbfb;
      --card: #fff;
      --glass: rgba(255, 255, 255, 0.85);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --dark-brown: #603813; /* –¢–µ–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', 'Segoe UI', system-ui, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Header - —É–¥–∞–ª–µ–Ω */
    header {
      display: none;
    }

    .logo {
      font-weight: 800;
      font-size: 24px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .logo i {
      animation: bounce 2s infinite;
    }

    .tag {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 4px;
      animation: fadeIn 0.7s ease-out 0.2s both;
    }

    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px;
      animation: fadeIn 0.6s ease-out;
    }

    /* Top controls */
    .top-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      animation: fadeIn 0.7s ease-out 0.3s both;
    }

    .segmented {
      background: var(--secondary);
      padding: 6px;
      border-radius: 12px;
      display: inline-flex;
      gap: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .segmented button {
      background: transparent;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      min-width: 120px;
    }

    .segmented button:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.7);
    }

    .segmented button.active {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 12px rgba(251, 112, 44, 0.3);
    }

    /* Delivery banner */
    .delivery {
      background: linear-gradient(135deg, var(--primary-light), #fff);
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
      font-weight: 700;
      font-size: 15px;
      color: var(--dark-brown);
      border: 2px solid var(--secondary);
      margin: 20px 0;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.8s ease-out 0.4s both;
    }

    .delivery::before {
      content: "üöö";
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      animation: bounce 2s infinite;
    }

    /* Product grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      border: 1px solid #eee;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      transition: var(--transition);
      animation: fadeIn 0.5s ease-out;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .card::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.7s;
    }

    .card:hover::after {
      left: 100%;
    }

    .img {
      height: 160px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--secondary), #fafafa);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--dark-brown);
      font-weight: 700;
      overflow: hidden;
      position: relative;
    }

    .img::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.8) 50%, transparent 70%);
      background-size: 200% 200%;
      animation: shimmer 2s infinite;
    }

    .title {
      font-weight: 800;
      margin-top: 12px;
      font-size: 17px;
      color: var(--text);
    }

    .meta {
      font-size: 13px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    .price {
      margin-top: 12px;
      font-weight: 900;
      color: var(--accent);
      font-size: 20px;
    }

    .card .actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
      align-items: center;
      padding-top: 12px;
    }

    .btn {
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    .btn.primary {
      background: linear-gradient(135deg, var(--primary), #FF8C42);
      color: white;
      flex: 1;
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, #FF8C42, var(--primary));
      box-shadow: 0 6px 20px rgba(251, 112, 44, 0.4);
    }

    .btn.ghost {
      background: #fff;
      border: 2px solid #ddd;
      color: var(--text);
    }

    .btn.ghost:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .btn.accent {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
    }

    .btn.accent:hover {
      background: linear-gradient(135deg, var(--accent-light), var(--accent));
      box-shadow: 0 6px 20px rgba(32, 172, 23, 0.4);
    }

    /* Fixed cart summary */
    .cart-summary {
      position: fixed;
      left: 16px;
      right: 16px;
      bottom: 85px;
      background: linear-gradient(135deg, var(--primary), #FF8C42);
      color: #fff;
      padding: 16px 20px;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      z-index: 60;
      animation: fadeIn 0.5s ease-out;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .cart-summary.hidden {
      transform: translateY(100px);
      opacity: 0;
      pointer-events: none;
    }

    /* Bottom nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: space-around;
      padding: 12px 8px;
      z-index: 70;
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.08);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      color: var(--muted);
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 12px;
      transition: var(--transition);
      min-width: 60px;
    }

    .nav-item:hover {
      background: rgba(251, 112, 44, 0.1);
      color: var(--primary);
      transform: translateY(-5px);
    }

    .nav-item.active {
      color: var(--primary);
      font-weight: 800;
      background: rgba(251, 112, 44, 0.15);
    }

    .nav-item i {
      font-size: 20px;
      margin-bottom: 4px;
    }

    /* Pages */
    .page {
      display: none;
      padding-bottom: 150px;
      animation: fadeIn 0.4s ease-out;
    }

    .page.active {
      display: block;
    }

    /* Builder */
    .builder {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .formats {
      display: flex;
      gap: 12px;
      overflow: auto;
      padding: 10px 5px;
    }

    .format {
      min-width: 140px;
      padding: 16px;
      border-radius: 12px;
      border: 2px solid #eee;
      background: #fff;
      cursor: pointer;
      transition: var(--transition);
      flex-shrink: 0;
    }

    .format:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 10px 20px rgba(251, 112, 44, 0.15);
    }

    .format.active {
      background: linear-gradient(135deg, var(--primary-light), #fff);
      border-color: var(--primary);
      box-shadow: 0 10px 25px rgba(251, 112, 44, 0.2);
    }

    .cells {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 14px;
    }

    .cell {
      padding: 16px;
      border-radius: 12px;
      border: 2px dashed #ddd;
      background: #fff;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .cell:hover {
      border-color: var(--primary);
      transform: scale(1.02);
    }

    .cell.filled {
      border-style: solid;
      border-color: var(--primary);
      background: linear-gradient(135deg, #FFF5EB, #fff);
    }

    .cell .name {
      font-weight: 800;
      margin-bottom: 5px;
    }

    .cell .small {
      font-size: 12px;
      color: var(--muted);
    }

    .cell .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(32, 172, 23, 0.1);
      color: var(--accent);
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    /* Modal & form */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      animation: fadeIn 0.3s ease-out;
      backdrop-filter: blur(5px);
    }

    .modal .panel {
      background: var(--glass);
      backdrop-filter: blur(20px);
      padding: 24px;
      border-radius: var(--radius);
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.4s ease-out 0.1s both;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .form-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
    }

    input, select, textarea {
      padding: 14px;
      border-radius: 10px;
      border: 2px solid #ddd;
      width: 100%;
      font-family: inherit;
      font-size: 15px;
      transition: var(--transition);
      background: rgba(255, 255, 255, 0.8);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(251, 112, 44, 0.2);
    }

    /* Profile */
    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 20px;
    }

    .mini {
      background: var(--card);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .mini:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 100px;
      right: 20px;
      background: linear-gradient(135deg, var(--primary), #FF8C42);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 12px;
      animation: fadeIn 0.3s ease-out, fadeIn 0.3s ease-out 2.7s reverse forwards;
      max-width: 350px;
    }

    /* Loading overlay */
    .loading {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(251, 112, 44, 0.2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Progress bar */
    .progress {
      height: 6px;
      background: #eee;
      border-radius: 3px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), #FF8C42);
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* Badge */
    .badge {
      display: inline-block;
      background: var(--accent);
      color: white;
      font-size: 12px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 20px;
      margin-left: 8px;
      animation: pulse 2s infinite;
    }

    /* Registration form */
    .register-form {
      max-width: 500px;
      margin: 0 auto;
      background: var(--glass);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .register-form h2 {
      color: var(--primary);
      margin-bottom: 20px;
      text-align: center;
    }

    /* About page styles */
    .about-section {
      margin-bottom: 30px;
      animation: fadeIn 0.6s ease-out;
    }

    .about-section h3 {
      color: var(--primary);
      font-size: 18px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .about-section h3 i {
      font-size: 20px;
    }

    .mission-statement {
      font-size: 16px;
      line-height: 1.6;
      color: var(--text);
      padding: 20px;
      background: linear-gradient(135deg, var(--primary-light), #fff);
      border-radius: var(--radius);
      border-left: 4px solid var(--primary);
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }

    .advantages-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .advantages-list li {
      padding: 16px;
      margin-bottom: 12px;
      background: var(--card);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: var(--transition);
      border: 1px solid #eee;
      box-shadow: var(--shadow);
    }

    .advantages-list li:hover {
      transform: translateX(5px);
      border-color: var(--primary);
      background: linear-gradient(135deg, #fff, var(--primary-light));
    }

    .advantages-list li i {
      color: var(--accent);
      font-size: 18px;
      width: 24px;
    }

    .faq-item {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid #eee;
      transition: var(--transition);
      box-shadow: var(--shadow);
    }

    .faq-item:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .faq-question {
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .faq-answer {
      color: var(--muted);
      line-height: 1.6;
      padding-left: 26px;
    }

    /* Loyalty system improvements */
    .loyalty-card {
      background: linear-gradient(135deg, var(--secondary), #fff);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      border: 2px solid var(--primary-light);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .loyalty-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary), var(--accent));
    }

    .loyalty-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(251, 112, 44, 0.15);
    }

    .loyalty-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .loyalty-level {
      background: linear-gradient(135deg, var(--primary), #FF8C42);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
    }

    .loyalty-price {
      font-size: 20px;
      font-weight: 900;
      color: var(--accent);
      margin: 8px 0;
    }

    .loyalty-description {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
      margin-top: 8px;
    }

    .loyalty-benefits {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .loyalty-benefit {
      background: rgba(32, 172, 23, 0.1);
      color: var(--accent);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .profile-grid {
        grid-template-columns: 1fr;
      }

      .cart-summary {
        left: 12px;
        right: 12px;
        bottom: 80px;
      }

      .segmented button {
        min-width: 100px;
        padding: 10px 16px;
      }

      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 16px;
      }

      .builder > div {
        flex-direction: column;
      }

      .builder > div > div:last-child {
        width: 100%;
      }

      .loyalty-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }

    @media (max-width: 480px) {
      .product-grid {
        grid-template-columns: 1fr;
      }

      .segmented {
        width: 100%;
      }

      .segmented button {
        flex: 1;
        min-width: auto;
      }

      .advantages-list li {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }

    /* Utility classes */
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    .slide-in {
      animation: slideIn 0.5s ease-out;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    .float {
      animation: float 3s ease-in-out infinite;
    }

    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mt-2 { margin-top: 8px; }
    .mt-4 { margin-top: 16px; }
    .mb-4 { margin-bottom: 16px; }
    .p-4 { padding: 16px; }
  </style>
</head>
<body>
  <!-- Loading overlay -->
  <div class="loading hidden" id="loading">
    <div class="spinner"></div>
    <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <!-- Notification -->
  <div class="notification hidden" id="notification">
    <i class="fas fa-check-circle"></i>
    <div id="notification-text">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>
  </div>

  <!-- Welcome modal -->
  <div id="welcomeModal" class="modal" style="display:none">
    <div class="panel">
      <h3>–ß—Ç–æ —É–º–µ–µ—Ç —ç—Ç–æ—Ç –±–æ—Ç?</h3>
      <p>–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –∏–ª–∏ —Å–æ–±—Ä–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –±–æ–∫—Å, –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã –∏ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑.</p>
      <p>–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª: <a href="#" id="tgChannelLink">@fruno_channel</a></p>
      <div class="progress mt-4">
        <div class="progress-bar" style="width: 0%" id="welcomeProgress"></div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:20px">
        <button class="btn ghost" onclick="closeWelcome(true)">–ù–∞—á–∞—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å 500 ‚ÇΩ</button>
        <button class="btn primary" onclick="closeWelcome(false)">–ü—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- Registration modal -->
  <div id="registerModal" class="modal hidden">
    <div class="panel">
      <div class="register-form">
        <h2><i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form id="registrationForm" onsubmit="handleRegistration(event)">
          <div class="form-row">
            <div style="flex:1">
              <label for="regName">–ò–º—è *</label>
              <input type="text" id="regName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            <div style="flex:1">
              <label for="regLastName">–§–∞–º–∏–ª–∏—è</label>
              <input type="text" id="regLastName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é">
            </div>
          </div>

          <div class="form-row">
            <div style="flex:1">
              <label for="regEmail">Email *</label>
              <input type="email" id="regEmail" required placeholder="example@mail.com">
            </div>
            <div style="flex:1">
              <label for="regPhone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <input type="tel" id="regPhone" required placeholder="+7 (999) 123-45-67">
            </div>
          </div>

          <div class="form-row">
            <div style="flex:1">
              <label for="regCity">–ì–æ—Ä–æ–¥</label>
              <input type="text" id="regCity" placeholder="–í–∞—à –≥–æ—Ä–æ–¥">
            </div>
            <div style="flex:1">
              <label for="regBirthdate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
              <input type="date" id="regBirthdate">
            </div>
          </div>

          <div>
            <label for="regSource">–ö–∞–∫ –≤—ã —É–∑–Ω–∞–ª–∏ –æ –Ω–∞—Å?</label>
            <select id="regSource">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
              <option value="friends">–û—Ç –¥—Ä—É–∑–µ–π</option>
              <option value="social">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</option>
              <option value="search">–ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ</option>
              <option value="ad">–†–µ–∫–ª–∞–º–∞</option>
              <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>

          <div style="margin-top: 16px;">
            <label>
              <input type="checkbox" id="regAgreement" required>
              –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="#" onclick="event.preventDefault(); alert('–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è')">—É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a> –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            </label>
          </div>

          <div style="display:flex;gap:12px;margin-top:24px">
            <button type="button" class="btn ghost" onclick="closeRegistration()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn primary">
              <i class="fas fa-user-check"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Top segmented control -->
    <div class="top-actions">
      <div class="segmented" role="tablist">
        <button class="active" id="tabMenu" onclick="openPage('menu')">
          <i class="fas fa-store"></i> –ú–µ–Ω—é
        </button>
        <button id="tabBuilder" onclick="openPage('builder')">
          <i class="fas fa-box-open"></i> –°–æ–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä
        </button>
        <button id="tabRegister" onclick="openRegistration()">
          <i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        </button>
      </div>
    </div>

    <!-- Delivery banner -->
    <div class="delivery">
      –î–æ—Å—Ç–∞–≤–∏–º –∑–∞–≤—Ç—Ä–∞ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç L
      <span class="badge">NEW</span>
    </div>

    <!-- Pages -->
    <div id="menu" class="page active">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <h2 style="color:var(--primary)">
          <i class="fas fa-gift float"></i> –ì–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã
        </h2>
        <div style="color:var(--muted);font-size:14px">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä –∏–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π</div>
      </div>

      <div class="product-grid" id="bundlesGrid"></div>

      <h3 style="margin-top:24px;color:var(--primary);display:flex;align-items:center;gap:10px">
        <i class="fas fa-puzzle-piece"></i> –§–æ—Ä–º–∞—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏
      </h3>
      <div class="product-grid" id="formatsGrid"></div>
    </div>

    <div id="builder" class="page">
      <h2 style="color:var(--primary);display:flex;align-items:center;gap:10px">
        <i class="fas fa-boxes"></i> –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
      </h2>
      <div class="builder">
        <div class="formats" id="formatsList"></div>
        <div style="display:flex;gap:16px;align-items:flex-start">
          <div style="flex:1">
            <div class="cells" id="boxCells"></div>
          </div>
          <div style="width:320px">
            <div class="mini">
              <div style="font-weight:800;display:flex;align-items:center;gap:8px">
                <i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
              </div>
              <div id="previewText" style="color:var(--muted);margin-top:12px;min-height:60px;line-height:1.5">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–∑–∏—Ü–∏–∏</div>
              <div style="margin-top:16px;display:flex;gap:10px">
                <button class="btn primary" id="confirmBoxBtn">
                  <i class="fas fa-check-circle"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–∞–±–æ—Ä
                </button>
                <button class="btn ghost" onclick="resetDraft()">
                  <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å
                </button>
              </div>
            </div>
            <div style="height:16px"></div>
            <div class="mini">
              <div style="font-weight:800;display:flex;align-items:center;gap:8px">
                <i class="fas fa-shopping-basket"></i> –ö–∞—Ç–∞–ª–æ–≥ (23 –ø–æ–∑–∏—Ü–∏–∏)
              </div>
              <div style="margin-top:12px;max-height:300px;overflow:auto" id="catalogList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="cart" class="page">
      <h2 style="color:var(--primary);display:flex;align-items:center;gap:10px">
        <i class="fas fa-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞
      </h2>
      <div id="cartContent"></div>
      <div style="height:20px"></div>
      <div class="mini">
        <div style="font-weight:800;display:flex;align-items:center;gap:8px">
          <i class="fas fa-file-invoice-dollar"></i> –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
        </div>
        <div style="margin-top:16px">
          <label>–¢–∏–ø</label>
          <select id="purchaseType">
            <option value="once">–†–∞–∑–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞</option>
            <option value="sub3">–ü–æ–¥–ø–∏—Å–∫–∞ 3 –º–µ—Å (10% —Å–∫–∏–¥–∫–∞)</option>
            <option value="sub6">–ü–æ–¥–ø–∏—Å–∫–∞ 6 –º–µ—Å (15% —Å–∫–∏–¥–∫–∞)</option>
          </select>
        </div>

        <!-- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ -->
        <div style="margin-top:24px;padding:20px;background:linear-gradient(135deg, var(--primary-light), #fff);border-radius:var(--radius);border:2px solid var(--primary-light);">
          <div style="font-weight:800;display:flex;align-items:center;gap:8px;margin-bottom:20px;color:var(--primary);font-size:18px">
            <i class="fas fa-crown"></i>
            <div>–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</div>
          </div>

          <div style="font-size:14px;margin-bottom:20px;color:var(--muted);padding:12px;background:rgba(255,255,255,0.7);border-radius:10px;">
            <div id="loyaltyStatus" style="font-weight:600;">–ó–∞–∫–∞–∑–æ–≤: 0. –í–∞—à —É—Ä–æ–≤–µ–Ω—å: –ù–µ—Ç</div>
            <div style="font-size:12px;margin-top:4px;color:var(--dark-brown);">–ù–∞–∫–æ–ø–∏—Ç–µ –∑–∞–∫–∞–∑—ã –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —Å–∫–∏–¥–∫–∏!</div>
          </div>

          <div id="loyaltyCards" class="loyalty-cards-container"></div>

          <div style="font-size:12px;color:var(--muted);padding:12px;background:rgba(255,255,255,0.5);border-radius:8px;margin-top:16px">
            <i class="fas fa-info-circle"></i>
            –í—ã –º–æ–∂–µ—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ª—é–±–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å–∫–∏–¥–∫—É –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π
          </div>
        </div>

        <div style="margin-top:16px">
          <label>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –±–æ–Ω—É—Å—ã (–±–∞–ª–ª—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è): <span id="bonusAvailable">0</span> ‚ÇΩ</label>
          <div style="margin-top:8px">
            <input type="checkbox" id="applyBonus" />
            <span style="margin-left:8px">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã</span>
          </div>
        </div>
        <div style="margin-top:16px">
          <label>–ü—Ä–æ–º–æ–∫–æ–¥</label>
          <input id="promo" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" />
        </div>
        <div style="margin-top:16px">
          <label>–î–æ—Å—Ç–∞–≤–∫–∞</label>
          <select id="deliveryType">
            <option value="courier">–ö—É—Ä—å–µ—Ä ‚Äî 500 ‚ÇΩ (–µ—Å–ª–∏ < L)</option>
            <option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
          </select>
        </div>
        <div style="margin-top:20px">
          <button class="btn primary" id="checkoutBtn" style="width:100%">
            <i class="fas fa-credit-card"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
          </button>
        </div>
      </div>
    </div>

    <div id="profile" class="page">
      <h2 style="color:var(--primary);display:flex;align-items:center;gap:10px">
        <i class="fas fa-user-circle"></i> –ú–æ–π –∞–∫–∫–∞—É–Ω—Ç
      </h2>
      <div class="profile-grid">
        <div>
          <div class="mini">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:800;font-size:20px">–ü—Ä–∏–≤–µ—Ç, <span id="userName">–ì–æ—Å—Ç—å</span></div>
                <div style="color:var(--muted);font-size:14px;margin-top:4px">–ë–æ–Ω—É—Å—ã: <strong id="userBonuses">0</strong> ‚ÇΩ</div>
                <button class="btn ghost mt-4" onclick="editUserName()">
                  <i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è
                </button>
              </div>
              <div>
                <button class="btn accent" onclick="openRegistration()">
                  <i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
                <button class="btn ghost mt-2" onclick="logout()">
                  <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
              </div>
            </div>
          </div>

          <div style="height:16px"></div>
          <div class="mini">
            <div style="font-weight:800;display:flex;align-items:center;gap:8px">
              <i class="fas fa-history"></i> –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
            </div>
            <div id="ordersList" style="margin-top:12px;color:var(--muted)">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
          </div>

          <div style="height:16px"></div>
          <div class="mini">
            <div style="font-weight:800;display:flex;align-items:center;gap:8px">
              <i class="fas fa-calendar-check"></i> –ü–æ–¥–ø–∏—Å–∫–∏
            </div>
            <div id="subsList" style="margin-top:12px;color:var(--muted)">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫</div>
          </div>

        </div>
        <div>
          <div class="mini">
            <div style="font-weight:800;display:flex;align-items:center;gap:8px">
              <i class="fas fa-user-friends"></i> –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
            </div>
            <div style="margin-top:12px;color:var(--muted)" id="refBox">
              –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞ ‚Äî –≤—ã –æ–±–∞ –ø–æ–ª—É—á–∏—Ç–µ 500 ‚ÇΩ
              <div class="mt-4">
                <input type="text" id="refLink" value="https://fruno.example/ref/guest123" readonly style="font-size:12px;padding:8px">
                <button class="btn ghost mt-2" onclick="copyRefLink()">
                  <i class="fas fa-copy"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
              </div>
            </div>
          </div>

          <div style="height:16px"></div>
          <div class="mini">
            <div style="font-weight:800;display:flex;align-items:center;gap:8px">
              <i class="fas fa-headset"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
            </div>
            <div style="margin-top:12px;color:var(--muted)">
              <div><i class="fas fa-envelope"></i> help@fruno.example</div>
              <div class="mt-2"><i class="fas fa-phone"></i> +7 (900) 000-00-00</div>
              <div class="mt-2"><i class="fas fa-clock"></i> –ü–Ω-–ü—Ç: 9:00-21:00</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="about" class="page">
      <h2 style="color:var(--primary);display:flex;align-items:center;gap:10px">
        <i class="fas fa-info-circle"></i> –û –ø—Ä–æ–µ–∫—Ç–µ
      </h2>

      <div class="about-section">
        <div class="mission-statement">
          <strong>–ú–∏—Å—Å–∏—è</strong><br>
          –ú—ã –¥–µ–ª–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –ø–æ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏: —á–µ—Å—Ç–Ω—ã–µ —Ü–µ–Ω—ã ‚Äî —á–µ—Å—Ç–Ω—ã–π –≤–∫—É—Å.
        </div>
      </div>

      <div class="about-section">
        <h3><i class="fas fa-star"></i> –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h3>
        <ul class="advantages-list">
          <li>
            <i class="fas fa-tag"></i>
            <div>
              <strong>–ß–µ—Å—Ç–Ω—ã–µ —Ü–µ–Ω—ã</strong><br>
              <span style="font-size:13px;color:var(--muted)">–ë–µ–∑ –Ω–∞—Ü–µ–Ω–æ–∫ –∏ —Å–∫—Ä—ã—Ç—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</span>
            </div>
          </li>
          <li>
            <i class="fas fa-calendar-day"></i>
            <div>
              <strong>–°–≤–µ–∂–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</strong><br>
              <span style="font-size:13px;color:var(--muted)">–¢–æ–ª—å–∫–æ —Å–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –æ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</span>
            </div>
          </li>
          <li>
            <i class="fas fa-shipping-fast"></i>
            <div>
              <strong>–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</strong><br>
              <span style="font-size:13px;color:var(--muted)">–î–æ—Å—Ç–∞–≤–∏–º –≤ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –≤–∞—Å –≤—Ä–µ–º—è</span>
            </div>
          </li>
          <li>
            <i class="fas fa-leaf"></i>
            <div>
              <strong>–≠–∫–æ–ª–æ–≥–∏—á–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞</strong><br>
              <span style="font-size:13px;color:var(--muted)">–ó–∞–±–æ—Ç–∏–º—Å—è –æ –ø—Ä–∏—Ä–æ–¥–µ –∏ –±—É–¥—É—â–µ–º –ø–ª–∞–Ω–µ—Ç—ã</span>
            </div>
          </li>
          <li>
            <i class="fas fa-user-check"></i>
            <div>
              <strong>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</strong><br>
              <span style="font-size:13px;color:var(--muted)">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É</span>
            </div>
          </li>
        </ul>
      </div>

      <div class="about-section">
        <h3><i class="fas fa-question-circle"></i> FAQ</h3>

        <div class="faq-item">
          <div class="faq-question">
            <i class="fas fa-question"></i>
            –í–æ–ø—Ä–æ—Å: –ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?
          </div>
          <div class="faq-answer">
            –û—Ç–≤–µ—Ç: –í —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–π –∞–∫–∫–∞—É–Ω—Ç" ‚Üí "–ü–æ–¥–ø–∏—Å–∫–∏"
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question">
            <i class="fas fa-question"></i>
            –í–æ–ø—Ä–æ—Å: –ï—Å—Ç—å –ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ —Ä–µ–≥–∏–æ–Ω—ã?
          </div>
          <div class="faq-answer">
            –û—Ç–≤–µ—Ç: –î–∞, –¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question">
            <i class="fas fa-question"></i>
            –í–æ–ø—Ä–æ—Å: –ö–∞–∫–æ–π —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ —É –ø—Ä–æ–¥—É–∫—Ç–æ–≤?
          </div>
          <div class="faq-answer">
            –û—Ç–≤–µ—Ç: –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–º–µ—é—Ç —Å–≤–µ–∂–∏–π —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–π –Ω–∞ —É–ø–∞–∫–æ–≤–∫–µ
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question">
            <i class="fas fa-question"></i>
            –í–æ–ø—Ä–æ—Å: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–∞–≤ –Ω–∞–±–æ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞?
          </div>
          <div class="faq-answer">
            –û—Ç–≤–µ—Ç: –î–∞, –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –∑–∞–∫–∞–∑—ã"
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Cart summary fixed -->
  <div class="cart-summary hidden" id="cartSummary">
    <div id="cartSumText">–ö–æ—Ä–∑–∏–Ω–∞: 0 ‚ÇΩ</div>
    <div>
      <button class="btn accent" onclick="openPage('cart')">
        <i class="fas fa-shopping-cart"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
      </button>
    </div>
  </div>

  <!-- Bottom nav -->
  <div class="bottom-nav">
    <div class="nav-item active" onclick="openPage('menu',this)">
      <i class="fas fa-home"></i>
      <div>–ú–µ–Ω—é</div>
    </div>
    <div class="nav-item" onclick="openPage('cart',this)">
      <i class="fas fa-shopping-cart"></i>
      <div>–ö–æ—Ä–∑–∏–Ω–∞</div>
    </div>
    <div class="nav-item" onclick="openPage('profile',this)">
      <i class="fas fa-user"></i>
      <div>–ú–æ–π –∞–∫–∫–∞—É–Ω—Ç</div>
    </div>
    <div class="nav-item" onclick="openPage('about',this)">
      <i class="fas fa-info-circle"></i>
      <div>–û –ø—Ä–æ–µ–∫—Ç–µ</div>
    </div>
  </div>

  <script>
    /* --- Mock data and app state --- */
    const PRODUCTS = (()=>{
      const titles = [
        '–ú—ë–¥ –≥—Ä–µ—á–∏—à–Ω—ã–π','–ú—ë–¥ —Ü–≤–µ—Ç–æ—á–Ω—ã–π','–ò–Ω–∂–∏—Ä —Å—É—à—ë–Ω—ã–π','–§—É–Ω–¥—É–∫','–ú–∏–Ω–¥–∞–ª—å —Å—ã—Ä–æ–π','–ö–µ—à—å—é','–ö–ª—é–∫–≤–∞ —Å—É—à—ë–Ω–∞—è','–ß–µ—Ä–Ω–∏–∫–∞','–ö—É—Ä–∞–≥–∞','–ò–∑—é–º','–§–∏–Ω–∏–∫','–ö–µ—à—å—é –∂–∞—Ä–µ–Ω—ã–π','–û—Ä–µ—Ö–æ–≤—ã–π –º–∏–∫—Å','–ì—Ä–∞–Ω–æ–ª–∞','–§–∏—Å—Ç–∞—à–∫–∏','–ö–æ–∫–æ—Å–æ–≤—ã–µ —á–∏–ø—Å—ã','–®–æ–∫–æ–ª–∞–¥–Ω—ã–µ –¥–æ–ª—å–∫–∏','–ö—Ä–µ–∫–µ—Ä','–ú–∞—Ä–º–µ–ª–∞–¥','–ê—Ä–∞—Ö–∏—Å —Å–æ–ª—ë–Ω—ã–π','–ö–æ–Ω—Ñ–∏—Ç—é—Ä','–°–µ–º–µ—á–∫–∏','–ü—Ä—è–Ω–∏–∫–∏'
      ];
      const arr = titles.slice(0,23).map((t,i)=>{
        let tier = 'std';
        if([2,5,9,14].includes(i)) tier='p199';
        if([3,12].includes(i)) tier='p399';
        const price = tier==='std'?120 + (i%5)*10 : tier==='p199'?199 : 399;
        return {id:'p'+i,title:t,price, tier, country:'–†–æ—Å—Å–∏—è', kcal: (400 + i*3)};
      });
      return arr;
    })();

    const FORMATS = [
      {id:'S',title:'S',desc:'4 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 250 –≥ (‚âà1 –∫–≥) ‚Äî –î–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞',cells:4,unit:250},
      {id:'M',title:'M',desc:'6 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 250 –≥ (‚âà1.5 –∫–≥) ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –Ω–∞ –Ω–µ–¥–µ–ª—é',cells:6,unit:250},
      {id:'L',title:'L',desc:'8 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 250 –≥ (‚âà2 –∫–≥) ‚Äî –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤–∫—É—Å–æ–≤',cells:8,unit:250},
      {id:'L2',title:'L¬≤',desc:'4 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 500 –≥ (‚âà2 –∫–≥) ‚Äî –ú–µ–Ω—å—à–µ –ø–æ–∑–∏—Ü–∏–π, –±–æ–ª—å—à–µ –æ–±—ä—ë–º–∞',cells:4,unit:500},
      {id:'XL',title:'XL',desc:'6 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 500 –≥ (‚âà3 –∫–≥) ‚Äî –î–ª—è —Å–µ–º—å–∏/–æ—Ñ–∏—Å–∞',cells:6,unit:500},
      {id:'2XL',title:'2XL',desc:'8 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 500 –≥ (‚âà4 –∫–≥) ‚Äî –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç',cells:8,unit:500},
      {id:'DEG',title:'–î–µ–≥—É—Å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π',desc:'10 –ø–æ–∑–∏—Ü–∏–∏ –ø–æ 100 –≥ (‚âà1 –∫–≥) ‚Äî –ü—Ä–æ–±–Ω—ã–π –Ω–∞–±–æ—Ä',cells:10,unit:100}
    ];

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
    const LOYALTY_LEVELS = [
      {
        id: 'level1',
        name: '–ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å',
        requiredOrders: 3,
        requiredMonths: 3,
        discount: 5,
        pricePerOrder: 2500,
        description: '–ü–æ—Å–ª–µ 3 –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–µ—Å—è—Ü–µ–≤ –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 5% –Ω–∞ 4-–π –∑–∞–∫–∞–∑',
        benefits: ['–°–∫–∏–¥–∫–∞ 5%', '3 –∑–∞–∫–∞–∑–∞', '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞']
      },
      {
        id: 'level2',
        name: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å',
        requiredOrders: 5,
        requiredMonths: 6,
        discount: 10,
        pricePerOrder: 2400,
        description: '–ü–æ—Å–ª–µ 5 –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤ –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 10% –Ω–∞ 6-–π –∑–∞–∫–∞–∑',
        benefits: ['–°–∫–∏–¥–∫–∞ 10%', '5 –∑–∞–∫–∞–∑–æ–≤', '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞', '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä']
      },
      {
        id: 'level3',
        name: '–ü—Ä–µ–º–∏—É–º —É—Ä–æ–≤–µ–Ω—å',
        requiredOrders: 10,
        requiredMonths: 12,
        discount: 15,
        pricePerOrder: 2300,
        description: '–ü–æ—Å–ª–µ 10 –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤ –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 15% –Ω–∞ 11-–π –∑–∞–∫–∞–∑',
        benefits: ['–°–∫–∏–¥–∫–∞ 15%', '10 –∑–∞–∫–∞–∑–æ–≤', 'VIP-–¥–æ—Å—Ç–∞–≤–∫–∞', '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è', '–ü–æ–¥–∞—Ä–∫–∏']
      }
    ];

    // app state (persisted)
    const STATE = {
      cart: JSON.parse(localStorage.getItem('fr_cart')||'[]'),
      drafts: JSON.parse(localStorage.getItem('fr_drafts')||'{}'),
      user: JSON.parse(localStorage.getItem('fr_user')||JSON.stringify({
        name:'–ì–æ—Å—Ç—å',
        bonuses:0,
        firstTime:true,
        registered:false,
        loyalty: {
          level: null,
          ordersCompleted: 0,
          firstOrderDate: null,
          prepaidOrders: 0
        }
      })),
      orders: JSON.parse(localStorage.getItem('fr_orders')||'[]'),
      registrations: JSON.parse(localStorage.getItem('fr_registrations')||'[]')
    };

    // Email service - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π email
    const EMAIL_SERVICE = {
      adminEmail: 'tolattigleb@yandex.ru',

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email —á–µ—Ä–µ–∑ Formspree (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å)
      sendEmail: async function(subject, body, type) {
        try {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º Formspree –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
          const formspreeEndpoint = 'https://formspree.io/f/xblnazpw'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Formspree ID

          const formData = new FormData();
          formData.append('_replyto', this.adminEmail);
          formData.append('_subject', subject);
          formData.append('message', body);
          formData.append('_format', 'plain');

          const response = await fetch(formspreeEndpoint, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });

          if (response.ok) {
            console.log(`Email sent successfully to ${this.adminEmail}`);
            return true;
          } else {
            console.error('Failed to send email');
            return false;
          }
        } catch (error) {
          console.error('Error sending email:', error);
          // Fallback: –ø–æ–ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥
          this.sendEmailFallback(subject, body, type);
          return false;
        }
      },

      // Fallback –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ mailto: —Å—Å—ã–ª–∫—É
      sendEmailFallback: function(subject, body, type) {
        const mailtoLink = `mailto:${this.adminEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

        // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—É—é —Å—Å—ã–ª–∫—É –∏ –∫–ª–∏–∫–∞–µ–º –ø–æ –Ω–µ–π
        const link = document.createElement('a');
        link.href = mailtoLink;
        link.target = '_blank';
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        console.log(`Fallback email triggered for ${type}`);
        return true;
      },

      sendRegistrationEmail: async function(regData) {
        const subject = `FRUNO: –ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - ${regData.name}`;
        const body = `
–ù–û–í–ê–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –í –°–ò–°–¢–ï–ú–ï FRUNO

–î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–º—è: ${regData.name}
–§–∞–º–∏–ª–∏—è: ${regData.lastName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
Email: ${regData.email}
–¢–µ–ª–µ—Ñ–æ–Ω: ${regData.phone}
–ì–æ—Ä–æ–¥: ${regData.city || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: ${regData.birthdate || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
–ò—Å—Ç–æ—á–Ω–∏–∫: ${regData.source || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}

–¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${new Date(regData.timestamp).toLocaleString('ru-RU')}
–ë–æ–Ω—É—Å—ã –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${regData.bonuses} ‚ÇΩ
ID —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${regData.id}

–°–¢–ê–¢–£–°: –ù–û–í–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–ª—É—á–∏–ª 500 –±–æ–Ω—É—Å–Ω—ã—Ö —Ä—É–±–ª–µ–π.
        `;

        const sent = await this.sendEmail(subject, body, 'registration');
        if (sent) {
          console.log('Registration email sent successfully');
        }
      },

      sendOrderEmail: async function(orderData, userData) {
        const subject = `FRUNO: –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Ññ${orderData.id}`;

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
        const itemsList = orderData.items.map(item =>
          `‚Ä¢ ${item.title}: ${item.price} ‚ÇΩ`
        ).join('\n');

        const body = `
–ù–û–í–´–ô –ó–ê–ö–ê–ó –û–§–û–†–ú–õ–ï–ù
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ó–ê–ö–ê–ó–ï:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ${orderData.id}
–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞: ${new Date(orderData.date).toLocaleString('ru-RU')}
–°—Ç–∞—Ç—É—Å: ${orderData.status}

–°–£–ú–ú–ê –ó–ê–ö–ê–ó–ê:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–û–±—â–∞—è —Å—É–º–º–∞: ${orderData.total} ‚ÇΩ
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${orderData.usedBonus} ‚ÇΩ
–ù–∞—á–∏—Å–ª–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${orderData.award} ‚ÇΩ
${orderData.loyaltyDiscount > 0 ? `–°–∫–∏–¥–∫–∞ –ø–æ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: ${orderData.loyaltyDiscount} ‚ÇΩ` : ''}

–î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–º—è: ${orderData.name}
–¢–µ–ª–µ—Ñ–æ–Ω: ${orderData.phone}
Email: ${userData.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}
–ë–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å: ${userData.bonuses || 0} ‚ÇΩ

–°–û–°–¢–ê–í –ó–ê–ö–ê–ó–ê:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${itemsList}

–ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –°–í–Ø–ó–ò:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–¢–µ–ª–µ—Ñ–æ–Ω: ${orderData.phone}
${userData.email ? `Email: ${userData.email}` : ''}

–°–¢–ê–¢–£–°: –¢–†–ï–ë–£–ï–¢–°–Ø –û–ë–†–ê–ë–û–¢–ö–ê
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ó–∞–∫–∞–∑ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
        `;

        const sent = await this.sendEmail(subject, body, 'order');
        if (sent) {
          console.log('Order email sent successfully');
        }
      }
    };

    // –§—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
    function calculateLoyaltyStatus() {
      const loyalty = STATE.user.loyalty || {
        level: null,
        ordersCompleted: 0,
        firstOrderDate: null,
        prepaidOrders: 0
      };

      // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã, –Ω–æ –Ω–µ—Ç –¥–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ–µ
      if (loyalty.ordersCompleted > 0 && !loyalty.firstOrderDate && STATE.orders.length > 0) {
        const firstOrder = STATE.orders.reduce((earliest, order) => {
          return new Date(order.date) < new Date(earliest.date) ? order : earliest;
        }, STATE.orders[0]);
        loyalty.firstOrderDate = firstOrder.date;
      }

      return loyalty;
    }

    function getCurrentLoyaltyLevel() {
      const loyalty = STATE.user.loyalty;
      if (!loyalty) return null;

      const totalOrders = loyalty.ordersCompleted + (loyalty.prepaidOrders || 0);
      const firstOrderDate = loyalty.firstOrderDate ? new Date(loyalty.firstOrderDate) : null;
      const now = new Date();

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
      for (let i = LOYALTY_LEVELS.length - 1; i >= 0; i--) {
        const level = LOYALTY_LEVELS[i];

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–∫–∞–∑–æ–≤
        if (totalOrders >= level.requiredOrders) {
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞)
          if (firstOrderDate) {
            const monthsDiff = (now.getFullYear() - firstOrderDate.getFullYear()) * 12 +
                              (now.getMonth() - firstOrderDate.getMonth());
            if (monthsDiff >= level.requiredMonths) {
              return level;
            }
          } else {
            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞, –Ω–æ –æ–ø–ª–∞—á–µ–Ω—ã –∑–∞–∫–∞–∑—ã –≤–ø–µ—Ä–µ–¥
            if (loyalty.prepaidOrders >= level.requiredOrders) {
              return level;
            }
          }
        }
      }

      return null;
    }

    function updateLoyaltyUI() {
      const loyalty = calculateLoyaltyStatus();
      const currentLevel = getCurrentLoyaltyLevel();

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –∫–æ—Ä–∑–∏–Ω–µ
      const loyaltyStatus = document.getElementById('loyaltyStatus');
      if (loyaltyStatus) {
        const totalOrders = loyalty.ordersCompleted + (loyalty.prepaidOrders || 0);
        const levelName = currentLevel ? currentLevel.name : '–ù–µ—Ç';
        loyaltyStatus.innerHTML = `<div style="color:var(--primary)">–ó–∞–∫–∞–∑–æ–≤: <strong>${totalOrders}</strong></div><div>–í–∞—à —É—Ä–æ–≤–µ–Ω—å: <strong style="color:var(--accent)">${levelName}</strong></div>`;
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
      const loyaltyCardsContainer = document.getElementById('loyaltyCards');
      if (loyaltyCardsContainer) {
        loyaltyCardsContainer.innerHTML = '';

        LOYALTY_LEVELS.forEach((level, index) => {
          const totalPrice = level.pricePerOrder * level.requiredOrders;
          const isCurrent = currentLevel && currentLevel.id === level.id;
          const progress = Math.min(((loyalty.ordersCompleted + (loyalty.prepaidOrders || 0)) / level.requiredOrders) * 100, 100);

          const card = document.createElement('div');
          card.className = 'loyalty-card';
          if (isCurrent) {
            card.style.borderColor = 'var(--accent)';
            card.style.boxShadow = '0 0 0 2px rgba(32, 172, 23, 0.2)';
          }

          card.innerHTML = `
            <div class="loyalty-header">
              <div style="font-weight:800;font-size:16px;color:var(--primary)">${level.name}</div>
              <div class="loyalty-level">${level.discount}% —Å–∫–∏–¥–∫–∞</div>
            </div>

            <div style="margin:12px 0">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <div style="font-size:14px;color:var(--muted)">–ü—Ä–æ–≥—Ä–µ—Å—Å:</div>
                <div style="font-size:14px;font-weight:600;color:var(--primary)">${loyalty.ordersCompleted + (loyalty.prepaidOrders || 0)}/${level.requiredOrders}</div>
              </div>
              <div style="height:6px;background:#eee;border-radius:3px;overflow:hidden">
                <div style="height:100%;width:${progress}%;background:linear-gradient(90deg,var(--primary),var(--accent));border-radius:3px;transition:width 0.5s"></div>
              </div>
            </div>

            <div class="loyalty-price">${totalPrice.toLocaleString()} ‚ÇΩ</div>
            <div class="loyalty-description">${level.description}</div>

            <div class="loyalty-benefits">
              ${level.benefits.map(benefit => `<span class="loyalty-benefit">${benefit}</span>`).join('')}
            </div>

            <div style="margin-top:16px">
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="radio" name="loyalty" value="${level.id}" id="loyalty${index + 1}" ${isCurrent ? 'checked' : ''}>
                <span style="font-size:14px">–í—ã–±—Ä–∞—Ç—å —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å</span>
              </label>
            </div>
          `;

          loyaltyCardsContainer.appendChild(card);
        });
      }
    }

    function applyLoyaltyDiscount(baseSum) {
      const selectedLevelId = document.querySelector('input[name="loyalty"]:checked')?.value;
      let discount = 0;
      let selectedLevel = null;

      if (selectedLevelId) {
        selectedLevel = LOYALTY_LEVELS.find(level => level.id === selectedLevelId);

        if (selectedLevel) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —É—Ä–æ–≤–Ω—è
          const loyalty = STATE.user.loyalty;
          const totalOrders = loyalty.ordersCompleted + (loyalty.prepaidOrders || 0);

          if (totalOrders >= selectedLevel.requiredOrders - 1) {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É
            discount = (baseSum * selectedLevel.discount) / 100;
            showNotification(`–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: ${selectedLevel.discount}%`);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–µ–¥–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
            if (!STATE.user.loyalty.prepaidOrders) {
              STATE.user.loyalty.prepaidOrders = 0;
            }
            STATE.user.loyalty.prepaidOrders += selectedLevel.requiredOrders;
          }
        }
      }

      return {
        discount: discount,
        finalSum: baseSum - discount,
        level: selectedLevel
      };
    }

    // Notification system
    function showNotification(text, duration = 3000) {
      const notif = document.getElementById('notification');
      const notifText = document.getElementById('notification-text');
      notifText.innerText = text;
      notif.classList.remove('hidden');

      setTimeout(() => {
        notif.classList.add('hidden');
      }, duration);
    }

    // Loading overlay
    function showLoading() {
      document.getElementById('loading').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loading').classList.add('hidden');
    }

    // Initialize on load
    window.addEventListener('load',()=>{
      // Animate welcome modal progress bar
      setTimeout(() => {
        const progressBar = document.getElementById('welcomeProgress');
        if (progressBar) {
          let width = 0;
          const interval = setInterval(() => {
            if (width >= 100) {
              clearInterval(interval);
            } else {
              width += 10;
              progressBar.style.width = width + '%';
            }
          }, 100);
        }
      }, 500);

      renderBundles();
      renderFormats();
      renderCatalog();
      renderFormatsList();
      renderCartSummary();
      renderCart();
      renderProfile();
      updateLoyaltyUI();

      // Show welcome modal if first time
      const m = document.getElementById('welcomeModal');
      if(STATE.user.firstTime) {
        setTimeout(() => {
          m.style.display = 'flex';
        }, 800);
      }
    });

    /* --- Welcome flow --- */
    function closeWelcome(grant){
      const m = document.getElementById('welcomeModal');
      m.style.display = 'none';
      STATE.user.firstTime = false;

      if(grant){
        STATE.user.bonuses = (STATE.user.bonuses || 0) + 500;
        saveState();
        showNotification('üéâ –í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ 500 –±–æ–Ω—É—Å–Ω—ã—Ö —Ä—É–±–ª–µ–π!', 4000);
        renderProfile();
        renderCartSummary();

        // Open registration after bonus grant
        setTimeout(() => {
          openRegistration();
        }, 1500);
      }

      saveState();
    }

    /* --- Registration system --- */
    function openRegistration() {
      document.getElementById('registerModal').classList.remove('hidden');
    }

    function closeRegistration() {
      document.getElementById('registerModal').classList.add('hidden');
    }

    async function handleRegistration(event) {
      event.preventDefault();

      const regData = {
        id: 'reg_' + Date.now(),
        timestamp: new Date().toISOString(),
        name: document.getElementById('regName').value,
        lastName: document.getElementById('regLastName').value || '',
        email: document.getElementById('regEmail').value,
        phone: document.getElementById('regPhone').value,
        city: document.getElementById('regCity').value || '',
        birthdate: document.getElementById('regBirthdate').value || '',
        source: document.getElementById('regSource').value || '',
        bonuses: 500 // Welcome bonus
      };

      // Validate email
      if (!regData.email.includes('@')) {
        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
        return;
      }

      // Validate phone (simple check)
      if (regData.phone.length < 5) {
        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω');
        return;
      }

      showLoading();

      // Simulate registration process
      setTimeout(async () => {
        try {
          // Save to local storage
          STATE.registrations.push(regData);
          localStorage.setItem('fr_registrations', JSON.stringify(STATE.registrations));

          // Update user state
          STATE.user.name = regData.name;
          STATE.user.bonuses = (STATE.user.bonuses || 0) + 500;
          STATE.user.registered = true;
          STATE.user.email = regData.email;
          STATE.user.phone = regData.phone;

          saveState();

          // Send registration email to admin
          await EMAIL_SERVICE.sendRegistrationEmail(regData);

          // Close modal and show notification
          closeRegistration();
          showNotification(`üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${regData.name}! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 500 –±–æ–Ω—É—Å–Ω—ã—Ö —Ä—É–±–ª–µ–π. Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.`, 5000);

          // Update UI
          renderProfile();
          renderCartSummary();
          updateLoyaltyUI();

        } catch (error) {
          console.error('Registration error:', error);
          showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–æ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ email');
        } finally {
          hideLoading();
        }
      }, 1500);
    }

    /* --- Navigation --- */
    function openPage(id, navEl){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');

      // bottom nav active toggles
      document.querySelectorAll('.bottom-nav .nav-item').forEach(n=>n.classList.remove('active'));
      if(navEl) {
        navEl.classList.add('active');
      } else {
        // set appropriate bottom nav
        const map = {menu:0,cart:1,profile:2,about:3};
        document.querySelectorAll('.bottom-nav .nav-item')[map[id]].classList.add('active');
      }

      // segmented control
      document.getElementById('tabMenu').classList.toggle('active', id==='menu');
      document.getElementById('tabBuilder').classList.toggle('active', id==='builder');
      document.getElementById('tabRegister').classList.toggle('active', false);

      window.scrollTo({top: 0, behavior: 'smooth'});

      // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
      if (id === 'cart') {
        updateLoyaltyUI();
      }
    }

    /* --- Rendering: bundles (ready-made sets) --- */
    function renderBundles(){
      const el = document.getElementById('bundlesGrid');
      el.innerHTML = '';

      const ready = [
        {id:'b1',title:'–ë–æ–ª—å—à–æ–π –∑–∏–º–Ω–∏–π —Å–µ—Ç',price:12200,desc:'–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –Ω–∞–±–æ—Ä –∏–∑ 12 –ø–æ–∑–∏—Ü–∏–π'},
        {id:'b2',title:'–°–µ—Ç "–ü–æ–∑–¥–Ω—è—è –æ—Å–µ–Ω—å"',price:14500,desc:'–û—Å–µ–Ω–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, 10 –ø–æ–∑–∏—Ü–∏–π'},
        {id:'b3',title:'–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π –Ω–∞–±–æ—Ä S',price:2500,desc:'–î–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞, 4 –ø–æ–∑–∏—Ü–∏–∏'},
        {id:'b4',title:'–ü—Ä–µ–º–∏—É–º –∫–æ–ª–ª–µ–∫—Ü–∏—è',price:18900,desc:'–≠–ª–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, 8 –ø–æ–∑–∏—Ü–∏–π'}
      ];

      ready.forEach((b, index) => {
        const c = document.createElement('div');
        c.className = 'card';
        c.style.animationDelay = `${index * 0.1}s`;

        c.innerHTML = `
          <div class='img'>${b.title}</div>
          <div class='title'>${b.title}</div>
          <div class='meta'>${b.desc}</div>
          <div class='price'>${b.price.toLocaleString()} ‚ÇΩ</div>
          <div class='actions'>
            <button class='btn primary' onclick="addToCart({type:'bundle',id:'${b.id}',title:'${b.title}',price:${b.price}})">
              <i class='fas fa-cart-plus'></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
            </button>
            <button class='btn ghost' onclick="openDetails('${b.id}')">
              <i class='fas fa-info-circle'></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
            </button>
          </div>`;

        el.appendChild(c);
      });
    }

    function openDetails(id){
      showNotification(`–û—Ç–∫—Ä—ã—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–∞–±–æ—Ä–∞: ${id}. –í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.`);
    }

    /* --- Formats (for UI cards) --- */
    function renderFormats(){
      const el = document.getElementById('formatsGrid');
      el.innerHTML = '';

      FORMATS.forEach((f, index) => {
        const c = document.createElement('div');
        c.className = 'card';
        c.style.animationDelay = `${index * 0.1}s`;

        c.innerHTML = `
          <div class='img'>${f.title}</div>
          <div class='title'>${f.title} ‚Äî ${f.desc.split('‚Äî')[1].trim()}</div>
          <div class='meta'>${f.desc}</div>
          <div class='price'>–§–æ—Ä–º–∞—Ç: ${f.cells} –ø–æ–∑–∏—Ü–∏–π</div>
          <div class='actions'>
            <button class='btn primary' onclick="openBuilderWith('${f.id}')">
              <i class='fas fa-box-open'></i> –°–æ–±—Ä–∞—Ç—å
            </button>
          </div>`;

        el.appendChild(c);
      });
    }

    /* --- Builder logic --- */
    let currentDraft = {format:null,cells:[],notes:''};

    function renderFormatsList(){
      const wrap = document.getElementById('formatsList');
      wrap.innerHTML = '';

      FORMATS.forEach(f => {
        const b = document.createElement('div');
        b.className = 'format';
        b.innerHTML = `
          <div style="font-weight:800;font-size:18px">${f.title}</div>
          <div style='font-size:13px;color:#666;margin-top:6px'>${f.desc}</div>`;

        b.onclick = () => {
          selectFormat(f.id);
          document.querySelectorAll('.format').forEach(el => el.classList.remove('active'));
          b.classList.add('active');
          b.style.transform = 'translateY(-5px)';
        };

        wrap.appendChild(b);
      });
    }

    function openBuilderWith(id){
      openPage('builder');
      setTimeout(() => {
        selectFormat(id);
        document.querySelectorAll('.format').forEach(el => {
          if (el.textContent.includes(id)) {
            el.classList.add('active');
            el.style.transform = 'translateY(-5px)';
          }
        });
      }, 100);
    }

    function selectFormat(id){
      const f = FORMATS.find(x => x.id === id);
      if(!f) return;

      currentDraft.format = f;
      currentDraft.cells = Array.from({length: f.cells}, () => null);

      renderCells();
      updatePreview();
      saveDraft();

      showNotification(`–í—ã–±—Ä–∞–Ω —Ñ–æ—Ä–º–∞—Ç: ${f.title}`);
    }

    function renderCells(){
      const wrap = document.getElementById('boxCells');
      wrap.innerHTML = '';

      currentDraft.cells.forEach((c, i) => {
        const node = document.createElement('div');
        node.className = `cell ${c ? 'filled' : ''}`;

        if(c) {
          node.innerHTML = `
            <div class='name'>${c.title}</div>
            <div class='small'>${c.country} ‚Ä¢ ${c.kcal} kcal/100g</div>
            <div class='small'><strong>${c.price} ‚ÇΩ</strong></div>
            <button class='remove-btn' onclick='removeFromCell(${i})'>
              <i class='fas fa-times'></i>
            </button>`;
        } else {
          node.innerHTML = `
            <div class='name'>–Ø—á–µ–π–∫–∞ ${i+1}</div>
            <div class='small'>${currentDraft.format ? currentDraft.format.unit + ' –≥' : ''}</div>
            <div style='margin-top:12px'>
              <button class='btn ghost' onclick='openCatalogFor(${i})'>
                <i class='fas fa-plus'></i> –î–æ–±–∞–≤–∏—Ç—å
              </button>
            </div>`;
        }

        wrap.appendChild(node);
      });
    }

    function openCatalogFor(cellIndex){
      // Highlight catalog section
      const catalogList = document.getElementById('catalogList');
      catalogList.parentElement.parentElement.style.boxShadow = '0 0 0 3px rgba(251, 112, 44, 0.3)';
      catalogList.parentElement.parentElement.style.transition = 'box-shadow 0.3s';

      setTimeout(() => {
        catalogList.parentElement.parentElement.style.boxShadow = 'var(--shadow)';
      }, 2000);

      // Scroll to catalog
      catalogList.scrollIntoView({behavior: 'smooth', block: 'start'});

      window.catalogTarget = cellIndex;
      showNotification(`–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç –¥–ª—è —è—á–µ–π–∫–∏ ${cellIndex + 1}`);
    }

    function removeFromCell(i){
      currentDraft.cells[i] = null;
      renderCells();
      updatePreview();
      saveDraft();
      showNotification(`–ü–æ–∑–∏—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —è—á–µ–π–∫–∏ ${i+1}`);
    }

    /* --- Catalog rendering and select logic --- */
    function renderCatalog(){
      const wrap = document.getElementById('catalogList');
      wrap.innerHTML = '';

      PRODUCTS.forEach((p, index) => {
        const row = document.createElement('div');
        row.style.cssText = `
          display: flex;
          gap: 12px;
          align-items: center;
          padding: 12px;
          border-bottom: 1px solid #f0f0f0;
          transition: background 0.3s;
          animation: fadeIn 0.5s ease-out ${index * 0.05}s both;
        `;

        row.onmouseenter = () => row.style.background = '#f9f9f9';
        row.onmouseleave = () => row.style.background = '';

        row.innerHTML = `
          <div style='width:60px;height:60px;background:linear-gradient(135deg,#f0f0f0,#fafafa);border-radius:10px;display:flex;align-items:center;justify-content:center;color:#999;font-weight:700'>
            ${p.title.split(' ')[0].slice(0,2)}
          </div>
          <div style='flex:1'>
            <div style='font-weight:700'>${p.title}</div>
            <div style='font-size:12px;color:#666'>${p.country} ‚Ä¢ ${p.kcal} kcal/100g</div>
            ${p.tier !== 'std' ? `<div style='font-size:11px;color:#d32f2f;margin-top:2px'><i class='fas fa-crown'></i> –ü—Ä–µ–º–∏—É–º</div>` : ''}
          </div>
          <div style='text-align:right'>
            <div style='font-weight:800'>${p.price} ‚ÇΩ / 250 –≥</div>
            <div style='margin-top:8px'>
              <button class='btn primary' onclick='selectProduct("${p.id}")'>
                <i class='fas fa-plus'></i> –î–æ–±–∞–≤–∏—Ç—å
              </button>
            </div>
          </div>`;

        wrap.appendChild(row);
      });
    }

    function selectProduct(pid){
      const p = PRODUCTS.find(x => x.id === pid);
      if(!p) return;

      const idx = window.catalogTarget;
      if(idx == null){
        showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —è—á–µ–π–∫—É, –∫—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä');
        return;
      }

      // Prevent duplicates
      if(currentDraft.cells.some(c => c && c.id === p.id)){
        showNotification('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –¥–≤–∞–∂–¥—ã –≤ –Ω–∞–±–æ—Ä');
        return;
      }

      currentDraft.cells[idx] = p;
      renderCells();
      updatePreview();
      saveDraft();

      showNotification(`"${p.title}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ —è—á–µ–π–∫—É ${idx+1}`);
    }

    function updatePreview(){
      const preview = document.getElementById('previewText');
      if(!currentDraft.format) {
        preview.innerText = '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –Ω–∞–±–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ';
      } else {
        const chosen = currentDraft.cells.filter(Boolean).length;
        const total = currentDraft.format.cells;
        const percent = Math.round((chosen / total) * 100);

        preview.innerHTML = `
          <strong>${currentDraft.format.title}</strong><br>
          ${currentDraft.format.desc}<br><br>
          <div style="display:flex;align-items:center;gap:10px">
            <div style="flex:1;height:8px;background:#eee;border-radius:4px;overflow:hidden">
              <div style="height:100%;width:${percent}%;background:linear-gradient(90deg,var(--primary),#FF8C42);border-radius:4px;transition:width 0.5s"></div>
            </div>
            <div>${chosen} / ${total}</div>
          </div>`;
      }
    }

    function saveDraft(){
      const key = 'draft_' + (currentDraft.format ? currentDraft.format.id : 'unknown');
      STATE.drafts[key] = currentDraft;
      localStorage.setItem('fr_drafts', JSON.stringify(STATE.drafts));
    }

    function resetDraft(){
      if(!confirm('–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â–∏–π —á–µ—Ä–Ω–æ–≤–∏–∫? –í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

      currentDraft = {format: null, cells: []};
      renderCells();
      updatePreview();
      saveDraft();

      showNotification('–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–±—Ä–æ—à–µ–Ω');
    }

    document.getElementById('confirmBoxBtn').addEventListener('click', () => {
      if(!currentDraft.format) {
        showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –Ω–∞–±–æ—Ä–∞');
        return;
      }

      const missing = currentDraft.cells.some(c => !c);
      if(missing) {
        if(!confirm('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —è—á–µ–π–∫–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–±–æ—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É?')) return;
      }

      // Calculate price
      let price = 0;
      currentDraft.cells.forEach(c => {
        if(c) price += c.price;
      });

      const bundle = {
        type: 'custom',
        id: 'draft_' + Date.now(),
        title: `${currentDraft.format.title} ‚Äî –°–æ–±—Ä–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä`,
        price,
        items: currentDraft.cells.map(x => x ? {id: x.id, title: x.title, price: x.price} : null),
        format: currentDraft.format.id
      };

      addToCart(bundle);

      // Clear current draft
      currentDraft = {format: null, cells: []};
      renderCells();
      updatePreview();
      saveState();
      renderCart();
      renderCartSummary();

      showNotification('–ù–∞–±–æ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 3000);
    });

    /* --- Cart functions --- */
    function addToCart(item){
      // Add animation to cart button
      const cartBtn = document.querySelector('.bottom-nav .nav-item:nth-child(2) i');
      cartBtn.style.transform = 'scale(1.3)';
      cartBtn.style.color = 'var(--accent)';

      setTimeout(() => {
        cartBtn.style.transform = 'scale(1)';
        cartBtn.style.color = '';
      }, 300);

      STATE.cart.push(item);
      saveState();
      renderCart();
      renderCartSummary();

      // Show cart summary with animation
      const cartSummary = document.getElementById('cartSummary');
      cartSummary.classList.remove('hidden');
    }

    function saveState(){
      localStorage.setItem('fr_cart', JSON.stringify(STATE.cart));
      localStorage.setItem('fr_user', JSON.stringify(STATE.user));
      localStorage.setItem('fr_orders', JSON.stringify(STATE.orders));
      localStorage.setItem('fr_drafts', JSON.stringify(STATE.drafts));
      localStorage.setItem('fr_registrations', JSON.stringify(STATE.registrations));
    }

    function renderCartSummary(){
      const s = STATE.cart.reduce((a, b) => a + (b.price || 0), 0);
      const cartText = document.getElementById('cartSumText');

      // Animate price change
      const oldPrice = parseInt(cartText.innerText.replace(/\D/g, '')) || 0;
      if(s !== oldPrice) {
        cartText.style.transform = 'scale(1.1)';
        cartText.style.color = 'var(--accent-light)';

        setTimeout(() => {
          cartText.style.transform = 'scale(1)';
          cartText.style.color = '';
        }, 300);
      }

      cartText.innerText = `–ö–æ—Ä–∑–∏–Ω–∞: ${s.toLocaleString()} ‚ÇΩ`;

      const cartSummary = document.getElementById('cartSummary');
      if(s > 0) {
        cartSummary.classList.remove('hidden');
      } else {
        cartSummary.classList.add('hidden');
      }
    }

    function renderCart(){
      const el = document.getElementById('cartContent');

      if(STATE.cart.length === 0) {
        el.innerHTML = `
          <div class="mini" style="text-align:center;padding:40px">
            <i class="fas fa-shopping-cart" style="font-size:48px;color:#ddd;margin-bottom:16px"></i>
            <div style="font-weight:700;color:var(--muted)">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div style="color:var(--muted);margin-top:8px">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –º–µ–Ω—é</div>
            <button class="btn primary mt-4" onclick="openPage('menu')">
              <i class="fas fa-store"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–µ–Ω—é
            </button>
          </div>`;

        renderCartSummary();
        return;
      }

      let html = '';
      STATE.cart.forEach((it, idx) => {
        html += `
          <div class='mini' style='margin-bottom:12px;animation:fadeIn 0.5s ease-out ${idx * 0.1}s both'>
            <div style='display:flex;justify-content:space-between;align-items:flex-start'>
              <div style='font-weight:800;font-size:16px'>${it.title}</div>
              <div style='font-weight:900;color:var(--accent);font-size:18px'>${(it.price || 0).toLocaleString()} ‚ÇΩ</div>
            </div>`;

        if(it.items) {
          html += `<div style='margin-top:12px;color:#666;font-size:14px'>
            <i class='fas fa-box-open'></i> ${it.items.filter(i => i).map(itm => itm.title).join(', ')}
          </div>`;
        }

        html += `
            <div style='margin-top:16px;display:flex;gap:10px'>
              <button class='btn ghost' onclick='editCartItem(${idx})'>
                <i class='fas fa-edit'></i> –ò–∑–º–µ–Ω–∏—Ç—å
              </button>
              <button class='btn accent' onclick='removeCart(${idx})'>
                <i class='fas fa-trash'></i> –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </div>`;
      });

      el.innerHTML = html;
      renderCartSummary();
    }

    function editCartItem(idx){
      const it = STATE.cart[idx];
      if(it.type === 'bundle') {
        showNotification('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –ø—Ä–æ—Ç–æ—Ç–∏–ø–µ');
      } else if(it.type === 'custom') {
        openPage('builder');
        showNotification('–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä. –°–µ–π—á–∞—Å —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π.');
      }
    }

    function removeCart(idx){
      if(!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) return;

      // Animation
      const cartItem = document.querySelectorAll('#cartContent .mini')[idx];
      if(cartItem) {
        cartItem.style.transform = 'translateX(-100px)';
        cartItem.style.opacity = '0';
        cartItem.style.transition = 'all 0.3s';
      }

      setTimeout(() => {
        STATE.cart.splice(idx, 1);
        saveState();
        renderCart();
        renderCartSummary();
        showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
      }, 300);
    }

    document.getElementById('checkoutBtn').addEventListener('click', async () => {
      if(STATE.cart.length === 0) {
        showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º.');
        return;
      }

      // Check if user is registered
      if(!STATE.user.registered) {
        if(confirm('–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. –•–æ—Ç–∏—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–µ–π—á–∞—Å?')) {
          openRegistration();
        }
        return;
      }

      // Gather order data
      const name = prompt('–ò–º—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏', STATE.user.name || '');
      if(!name) return;

      const phone = prompt('–¢–µ–ª–µ—Ñ–æ–Ω', STATE.user.phone || '');
      if(!phone) return;

      // Compute base sum
      let sum = STATE.cart.reduce((a, b) => a + (b.price || 0), 0);
      const purchaseType = document.getElementById('purchaseType').value;

      if(purchaseType === 'sub3') sum = Math.round(sum * 0.9);
      if(purchaseType === 'sub6') sum = Math.round(sum * 0.85);

      // Apply loyalty discount
      const loyaltyDiscount = applyLoyaltyDiscount(sum);
      if (loyaltyDiscount.discount > 0) {
        sum = loyaltyDiscount.finalSum;
      }

      const applyBonus = document.getElementById('applyBonus').checked;
      let usedBonus = 0;

      if(applyBonus) {
        usedBonus = Math.min(STATE.user.bonuses || 0, sum);
        sum -= usedBonus;
      }

      // Award 5% back
      const award = Math.round((STATE.cart.reduce((a, b) => a + (b.price || 0), 0)) * 0.05);

      // Mock payment
      let paymentMessage = `–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: ${sum} ‚ÇΩ\n–°–ø–∏—Å–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${usedBonus} ‚ÇΩ`;

      if (loyaltyDiscount.discount > 0) {
        paymentMessage += `\n–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: ${loyaltyDiscount.discount} ‚ÇΩ`;
      }

      paymentMessage += `\n\n–û–ø–ª–∞—Ç–∏—Ç—å (—ç–º—É–ª—è—Ü–∏—è)?`;

      if(confirm(paymentMessage)){
        showLoading();

        // Simulate payment processing
        setTimeout(async () => {
          try {
            // Create order
            const order = {
              id: 'ORD' + Date.now().toString().slice(-6),
              name,
              phone,
              items: [...STATE.cart],
              total: sum,
              usedBonus,
              award,
              loyaltyDiscount: loyaltyDiscount.discount,
              loyaltyLevel: loyaltyDiscount.level ? loyaltyDiscount.level.id : null,
              status: 'confirmed',
              date: new Date().toISOString()
            };

            STATE.orders.push(order);

            // Update loyalty status
            if (!STATE.user.loyalty) {
              STATE.user.loyalty = {
                level: null,
                ordersCompleted: 0,
                firstOrderDate: null,
                prepaidOrders: 0
              };
            }

            STATE.user.loyalty.ordersCompleted++;

            // Set first order date if not set
            if (!STATE.user.loyalty.firstOrderDate) {
              STATE.user.loyalty.firstOrderDate = new Date().toISOString();
            }

            // Adjust bonuses
            STATE.user.bonuses = (STATE.user.bonuses || 0) - usedBonus + award;

            // Clear cart
            STATE.cart = [];

            saveState();
            renderCart();
            renderCartSummary();
            renderProfile();
            updateLoyaltyUI();

            // Send order email to admin
            await EMAIL_SERVICE.sendOrderEmail(order, STATE.user);

            hideLoading();

            showNotification(`üéâ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ${order.id}. –ë–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã. Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.`, 5000);

            // Show order confirmation
            let confirmationMessage = `–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n\n–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ${order.id}\n–°—É–º–º–∞: ${sum} ‚ÇΩ`;

            if (loyaltyDiscount.discount > 0) {
              confirmationMessage += `\n–°–∫–∏–¥–∫–∞ –ø–æ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: ${loyaltyDiscount.discount} ‚ÇΩ`;
            }

            confirmationMessage += `\n–°—Ç–∞—Ç—É—Å: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω\n\n–° –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.`;

            alert(confirmationMessage);
          } catch (error) {
            console.error('Order processing error:', error);
            showNotification('–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω, –Ω–æ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');
            hideLoading();
          }
        }, 2000);
      }
    });

    /* --- Profile rendering --- */
    function renderProfile(){
      document.getElementById('userName').innerText = STATE.user.name || '–ì–æ—Å—Ç—å';
      document.getElementById('userBonuses').innerText = (STATE.user.bonuses || 0);
      document.getElementById('bonusAvailable').innerText = (STATE.user.bonuses || 0);

      // Orders
      const ol = document.getElementById('ordersList');
      if(STATE.orders.length === 0) {
        ol.innerHTML = `
          <div style="text-align:center;padding:20px;color:#999">
            <i class="fas fa-shopping-bag" style="font-size:32px;margin-bottom:12px"></i>
            <div>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
          </div>`;
      } else {
        ol.innerHTML = STATE.orders.map(o => {
          let loyaltyInfo = '';
          if (o.loyaltyDiscount > 0) {
            loyaltyInfo = `<div style="font-size:12px;color:var(--primary);margin-top:4px">
              <i class="fas fa-crown"></i> –°–∫–∏–¥–∫–∞ –ø–æ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: ${o.loyaltyDiscount} ‚ÇΩ
            </div>`;
          }

          return `
          <div style='margin-bottom:12px;padding:12px;background:#f9f9f9;border-radius:10px'>
            <div style='display:flex;justify-content:space-between'>
              <div style='font-weight:700'>${o.id}</div>
              <div style='color:var(--accent);font-weight:800'>${o.total} ‚ÇΩ</div>
            </div>
            <div style='display:flex;justify-content:space-between;margin-top:6px;font-size:13px'>
              <div>${new Date(o.date).toLocaleDateString('ru-RU')}</div>
              <div style='color:var(--primary);font-weight:600'>${o.status}</div>
            </div>
            ${loyaltyInfo}
          </div>
          `;
        }).join('');
      }

      // Subs - prototype stores purchaseType as subs set? We'll show none
      document.getElementById('subsList').innerHTML = `
        <div style="text-align:center;padding:20px;color:#999">
          <i class="fas fa-calendar-alt" style="font-size:32px;margin-bottom:12px"></i>
          <div>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫</div>
          <button class="btn ghost mt-4" onclick="showNotification('–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É')">
            <i class="fas fa-plus-circle"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
          </button>
        </div>`;
    }

    function logout(){
      if(confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞? –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ—Ä–∑–∏–Ω–∞, –±–æ–Ω—É—Å—ã) –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.')){
        STATE.user = {
          name:'–ì–æ—Å—Ç—å',
          bonuses:0,
          firstTime:false,
          registered: false,
          loyalty: {
            level: null,
            ordersCompleted: 0,
            firstOrderDate: null,
            prepaidOrders: 0
          }
        };
        saveState();
        renderProfile();
        showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
      }
    }

    function editUserName(){
      const n = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è', STATE.user.name || '');
      if(n && n.trim() !== ''){
        STATE.user.name = n.trim();
        saveState();
        renderProfile();
        showNotification(`–ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞: ${n}`);
      }
    }

    function copyRefLink(){
      const refLink = document.getElementById('refLink');
      refLink.select();
      refLink.setSelectionRange(0, 99999);

      navigator.clipboard.writeText(refLink.value).then(() => {
        showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      });
    }

    /* --- Misc helpers --- */
    // Apply promo code
    document.getElementById('promo').addEventListener('change', (e) => {
      if(e.target.value.toUpperCase() === 'FRUNO50') {
        showNotification('–ü—Ä–æ–º–æ–∫–æ–¥ FRUNO50 –ø—Ä–∏–º–µ–Ω–µ–Ω: —Å–∫–∏–¥–∫–∞ 50‚ÇΩ (—ç–º—É–ª—è—Ü–∏—è)');
      } else if(e.target.value.toUpperCase() === 'WELCOME100') {
        showNotification('–ü—Ä–æ–º–æ–∫–æ–¥ WELCOME100 –ø—Ä–∏–º–µ–Ω–µ–Ω: —Å–∫–∏–¥–∫–∞ 100‚ÇΩ (—ç–º—É–ª—è—Ü–∏—è)');
      } else if(e.target.value.trim() !== '') {
        showNotification('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
      }
    });

    // Initial save
    saveState();

    // Add some interactive effects
    document.addEventListener('DOMContentLoaded', () => {
      // Add hover effects to all buttons
      document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-3px)';
        });

        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });

      // Add scroll animation for cards
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if(entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      document.querySelectorAll('.card, .mini, .format, .loyalty-card, .faq-item, .advantages-list li').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.5s, transform 0.5s';
        observer.observe(el);
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
      document.addEventListener('change', function(e) {
        if (e.target && e.target.name === 'loyalty') {
          updateLoyaltyUI();
        }
      });
    });
  </script>
</body>
</html>